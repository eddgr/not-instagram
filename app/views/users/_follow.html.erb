<% if session[:user_id].nil? || !session[:user_id].nil? && current_user.id != @user.id %>

  <% if !session[:user_id].nil? %>
    <% if !current_user.following?(@user) %>

      <%= form_for(current_user.active_relationships.build) do |f| %>
        <%= hidden_field_tag :followed_id, @user.id %>
        <%= f.submit "Follow", class: "btn btn-primary" %>
      <% end %>
    <% else %>

      <%= form_for(current_user.active_relationships.find_by(followed_id: @user.id), html: { method: :delete }) do |f| %>
        <%= f.submit "Unfollow", class: "btn btn-danger" %>
      <% end %>

    <% end %>

    <% else %>

    <%= link_to "Follow", user_path(@user), class: "btn btn-primary" %>
  <% end %>

<% end %>
